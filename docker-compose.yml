version: "3.8"
services:
  ilofan:
    image: iscalcio/ilo-fan-controller:latest
    build: .
    container_name: ilofan-pro
    labels:
      - "org.opencontainers.image.title=ilo fan controller"
    ports:
      - "${PORT:-8000}:8000"
    environment:
      - NODE_ENV=production
      - NODE_OPTIONS=--max-old-space-size=256
      - ILO_HOST=${ILO_HOST}
      - ILO_USERNAME=${ILO_USERNAME}
      - ILO_PASSWORD=${ILO_PASSWORD}
      - FAN_WRITE_COOLDOWN_MS=${FAN_WRITE_COOLDOWN_MS:-60000}
      - FAN_MIN_DELTA_PERCENT=${FAN_MIN_DELTA_PERCENT:-10}
    volumes:
      - ./data:/app/data
    mem_limit: 256m
    cpus: 0.5
    cpu_shares: 512
    restart: unless-stopped
